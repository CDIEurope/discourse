define("discourse/routes/application",["discourse/lib/computed","discourse/lib/show-modal","discourse/mixins/open-composer","exports"],function(o,t,e,i){"use strict";function n(o){return function(){this.site.get("isReadOnly")?bootbox.alert(I18n.t("read_only_mode.login_disabled")):this[o]()}}var s=o.setting,r=t["default"],a=e["default"],l=Discourse.Route.extend(a,{siteTitle:s("title"),actions:{_collectTitleTokens:function(o){o.push(this.get("siteTitle")),Discourse.set("_docTitle",o.join(" - "))},willTransition:function(){var o=this.container.lookup("router:main");return Ember.run.once(o,o.trigger,"willTransition"),this._super()},postChangedRoute:Ember.K,showTopicEntrance:function(o){this.controllerFor("topic-entrance").send("show",o)},postWasEnqueued:function(o){var t=o.reason?"queue_reason."+o.reason+".title":"queue.approval.title";r("post-enqueued",{model:o,title:t})},composePrivateMessage:function(o,t){var e=this;this.transitionTo("userActivity",o).then(function(){e.controllerFor("user-activity").send("composePrivateMessage",o,t)})},error:function(o,t){if(404===o.status)return void this.transitionTo("unknown");var e=this.controllerFor("exception"),i=o.stack,n=o.toString();i&&(n=i.toString()),o.statusText&&(n=o.statusText);var s=window.console;s&&s.error&&s.error(n),e.setProperties({lastTransition:t,thrown:o}),this.intermediateTransitionTo("exception")},showLogin:n("handleShowLogin"),showCreateAccount:n("handleShowCreateAccount"),showForgotPassword:function(){r("forgotPassword",{title:"forgot_password.title"})},showNotActivated:function(o){var t=r("not-activated",{title:"log_in"});t.setProperties(o)},showUploadSelector:function(o){r("uploadSelector"),this.controllerFor("upload-selector").setProperties({composerView:o})},showKeyboardShortcutsHelp:function(){r("keyboard-shortcuts-help",{title:"keyboard_shortcuts_help.title"})},showSearchHelp:function(){Discourse.ajax("/static/search_help.html",{dataType:"html"}).then(function(o){r("searchHelp",{model:o})})},closeModal:function(){this.render("hide-modal",{into:"modal",outlet:"modalBody"})},hideModal:function(){$("#discourse-modal").modal("hide")},reopenModal:function(){$("#discourse-modal").modal("show")},editCategory:function(o){var t=this;Discourse.Category.reloadById(o.get("id")).then(function(o){t.site.updateCategory(o),r("editCategory",{model:o}),t.controllerFor("editCategory").set("selectedTab","general")})},deleteSpammer:function(o){this.send("closeModal"),o.deleteAsSpammer(function(){window.location.reload()})},checkEmail:function(o){o.checkEmail()},changeBulkTemplate:function(o){var t=o.replace("modal/",""),e=this.container.lookupFactory("controller:"+t);this.render(o,{into:"modal/topic-bulk-actions",outlet:"bulkOutlet",controller:e?t:"topic-bulk-actions"})},createNewTopicViaParams:function(o,t,e,i){this.openComposerWithParams(this.controllerFor("discovery/topics"),o,t,e,i)}},activate:function(){this._super(),Em.run.next(function(){l.trigger("activate")})},handleShowLogin:function(){var o=this;if(this.siteSettings.enable_sso){var t=encodeURIComponent(window.location.pathname);window.location=Discourse.getURL("/session/sso?return_path="+t)}else this._autoLogin("login","login-modal",function(){return o.controllerFor("login").resetForm()})},handleShowCreateAccount:function(){if(this.siteSettings.enable_sso){var o=encodeURIComponent(window.location.pathname);window.location=Discourse.getURL("/session/sso?return_path="+o)}else this._autoLogin("createAccount","create-account")},_autoLogin:function(o,t,e){var i=Em.get("Discourse.LoginMethod.all");this.siteSettings.enable_local_logins||1!==i.length?(r(o),this.controllerFor("modal").set("modalClass",t),e&&e()):this.controllerFor("login").send("externalLogin",i[0])}});RSVP.EventTarget.mixin(l),i["default"]=l}),Discourse.ApplicationRoute=require("discourse/routes/application")["default"];